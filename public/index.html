<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-R" />
    <title>React Feedback Form</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState } = React;

      function App() {
        const [name, setName] = useState("");
        const [message, setMessage] = useState("");
        const [status, setStatus] = useState("");

        const submitFeedback = async () => {
          if (!name || !message) {
            setStatus("Please fill in all fields.");
            return;
          }

          // 1. Use the correct, relative path (starts with /.)
          const url = "/.netlify/functions/feedback";

          try {
            // 2. Use 'POST' to send data, not 'GET'
            const res = await fetch(url, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              // 3. Send data as a JSON string in the body
              body: JSON.stringify({ name, message }),
            });

            const data = await res.json();

            if (res.ok) {
              setStatus(data.message || "Feedback sent! Thank you.");
              setName("");
              setMessage("");
            } else {
              setStatus(data.error || "Error sending feedback.");
            }
          } catch (err) {
            console.error(err);
            setStatus("Error sending feedback.");
          }
        };

        return (
          <div style={{ padding: "20px", maxWidth: "400px", margin: "auto" }}>
            <h2>Feedback Form</h2>
            <input
              value={name}
              onChange={(e) => setName(e.target.value)}
              placeholder="Your Name"
              style={{ width: "100%", marginBottom: "10px" }}
            />
            <textarea
              value={message}
              onChange={(e) => setMessage(e.target.value)}
              placeholder="Your Feedback"
              style={{ width: "100%", marginBottom: "10px" }}
            ></textarea>
            <button onClick={submitFeedback}>Submit</button>
            <p>{status}</p>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
